<!DOCTYPE html>
<html lang="en">
<head>
	<title>EDLI Calculator</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">
	<style>
	.shadow {
		box-shadow: 0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);
	}
	.input {
		background: linear-gradient(#9dd2ea, #8bceec);
	}
	
	.list-group {
		box-shadow: 0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);
	}
	</style>

</head>

<body ng-app="myApp" ng-controller="namesCtrl" class="pt-100 pb-100">
	<header class="p-3 bg-info text-white">
		<div class="container">
		  <div class="d-flex flex-wrap align-items-center justify-content-center justify-content-lg-start">
			<ul class="nav col-12 col-lg-auto me-lg-auto mb-2 justify-content-center mb-md-0">
			  <li><a href="index.html" class="nav-link px-2 text-white">Home</a></li>
			  <li><a href="pension.html" class="nav-link px-2 text-white">Pension</a></li>
			  <li><a href="edli2.html" class="nav-link px-2 text-white">EDLI</a></li>
			</ul>
			<h3 class="text-center">EDLI CALCULATOR</h3>
		  </div>
		</div>
	</header>
    <div class="container-fluid" >
		<div class="row">
			<div class="col-md-6 col-sm-12  p-2 mt-2">
				<h3 class="text-center mb-3">EDLI Calculator Input</h3>
				<form class="shadow p-3 rounded">
					<div class="input-group mb-3">
						<span class="input-group-text col-5" id="basic-addon1">UAN: </span>
						<input type="number" maxlength="10" pattern="\d{10}" title="Please enter exactly 10 digits" ng-model="uan" class="form-control" placeholder="UAN" aria-label="UAN" aria-describedby="basic-addon1">
					</div>
					<span class="alert col-5" id="basic-addon1">{{alert}}</span>
					<div class="input-group mb-5">
						<span class="input-group-text col-5" id="basic-addon1" data-bs-toggle="modal" data-bs-target="#staticBackdrop">Date of Death : Click Here <i class="bi bi-exclamation-octagon-fill"> </i></span>
						<input type="date" ng-model="dod" class="form-control" ng-change="getParams(list,dod)" placeholder="dod" aria-label="dod" aria-describedby="basic-addon1">
					
					</div>
					
					<div class="input-group mb-5">
						<span class="input-group-text col-5" id="basic-addon1">Average Progressive Balance: </span>
						<input type="number" ng-model="apb" class="form-control" placeholder="apb" aria-label="apb" aria-describedby="basic-addon1">
					</div>
					<div class="input-group mb-5">
						<label for="customRange1" class="form-label">Average Progressive Balance:</label>
						<input type="range" class="form-range" id="customRange1" ng-model="apb" min="0" max="1000000">
					</div>
					
					<div class="input-group mb-5">
						<span class="input-group-text col-5" id="basic-addon1">Average Wages: </span>
						<input type="number" ng-model="avg_wage" class="form-control" placeholder="apb" aria-label="apb" aria-describedby="basic-addon1">
					</div>
					<div class="input-group mb-5">
						<label for="customRange1" class="form-label">Average Wages in preceding 12 Months (max:{{b_ceiling}}):</label>
						<input type="range" class="form-range" id="customRange1" ng-model="avg_wage" min="0" max="{{b_ceiling+1000}}">
					</div>
					
				</form>
			</div>
			<div class="col-md-6 col-sm-12 p-2">
				<ul class="list-group mb-3">
					<li class="list-group-item list-group-item-primary d-flex justify-content-between align-items-center">UAN: <span>{{uan}}</span></li>
					<li ng-if=0 class="list-group-item list-group-item d-flex justify-content-between align-items-center">Name: <span>{{name}}</span></li>
					<li class="list-group-item list-group-item d-flex justify-content-between align-items-center">Date of Death: <span>{{dod | date:'dd-MM-yyyy'}}</span></li>
				</ul>
				<ul class="list-group mb-3">
					<li class="list-group-item list-group-item-primary d-flex justify-content-between align-items-center">Part A Calculation <i class="bi bi-question-circle-fill" data-bs-toggle="modal" data-bs-target="#staticBackdrop1"> What are these parts?</i></li>
					<li ng-if=0 class="list-group-item list-group-item d-flex justify-content-between align-items-center">Total Progressive Balance: <span>{{tpb}}</span></li>
					<li class="list-group-item list-group-item d-flex justify-content-between align-items-center">Avg Progressive Balance: <span>{{apb}}</span></li>
					<li class="list-group-item list-group-item d-flex justify-content-between align-items-center">Minimum EDLI Amount(from table): <span>{{a_min}}</span></li>
					<li class="list-group-item list-group-item d-flex justify-content-between align-items-center">Percent of above Minimum Amount(from table): <span>{{a_perc1}}</span></li>
					<li class="list-group-item list-group-item d-flex justify-content-between align-items-center">Maximum EDLI Amount(from table): <span>{{a_max}}</span></li>
					<li class="list-group-item list-group-item d-flex justify-content-between align-items-center">Amount A (Calculated): <span>{{get_amt_a(a_min, a_max, apb, a_perc1)}}</span></li>
					<li class="list-group-item list-group-item d-flex justify-content-between align-items-center">Additional Amount Per(from table): <span>{{a_perc2}}</span></li>
					<li class="list-group-item list-group-item d-flex justify-content-between align-items-center">Additional Amount ({{a_perc2}}*amount ): <span>{{a_perc2*apb/100}}</span></li>
					<li class="list-group-item list-group-item-success d-flex justify-content-between align-items-center">Total Amount under Part A(Min+factor: <span>{{get_final_a(a_perc2,a_min, a_max, apb, a_perc1)}}</span></li>
				</ul>
				<ul class="list-group mb-3">
					<li class="list-group-item list-group-item-primary d-flex justify-content-between align-items-center">Part B Calculation</li>
					<li class="list-group-item list-group-item d-flex justify-content-between align-items-center">Average Wages: <span>{{avg_wage}}</span></li>
					<li class="list-group-item list-group-item d-flex justify-content-between align-items-center">Average Wages limit: <span>{{b_ceiling}}</span></li>
					<li class="list-group-item list-group-item d-flex justify-content-between align-items-center">Average Wages taken for Calculation: <span>{{getmin(avg_wage, b_ceiling)}}</span></li>
					<li class="list-group-item list-group-item d-flex justify-content-between align-items-center">Factor: <span>{{b_factor}}</span></li>
					<li class="list-group-item list-group-item-warning d-flex justify-content-between align-items-center ">EDLI (Avg Wages Calculated*Factor) [B1]: <span>{{ getmin(avg_wage, b_ceiling)*b_factor }}</span></li>
					<li class="list-group-item list-group-item d-flex justify-content-between align-items-center">Additional Amount (if below limit): <span>{{get_additional(avg_wage, b_ceiling, b_factor, b_perc)}}</span></li>
					<li class="list-group-item list-group-item d-flex justify-content-between align-items-center">Total till Now: <span>{{(getmin(avg_wage, b_ceiling)*b_factor) + get_additional(avg_wage, b_ceiling, b_factor, b_perc)}}</span></li>
					<li class="list-group-item list-group-item d-flex justify-content-between align-items-center">Percent for Avg Progressive Balance(APB): <span>{{b_perc1}}</span></li>
					<li class="list-group-item list-group-item d-flex justify-content-between align-items-center">APB Benefit: <span>{{b_perc1*apb/100}}</span></li>
					<li class="list-group-item list-group-item d-flex justify-content-between align-items-center">Max APB Benefit Allowed: <span>{{b_max}}</span></li>
					<li class="list-group-item list-group-item-warning d-flex justify-content-between align-items-center">Minimum Benefit allowed: <span>{{b_min}}</span></li>
					<li class="list-group-item list-group-item-success d-flex justify-content-between align-items-center">Total Benefit under Part B [B1 + B2]: <span>{{get_final_b(avg_wage, b_ceiling, b_factor, b_perc, b_perc1, apb, b_max, b_min) }}</span></li>
				</ul>
				
				<ul class="list-group mb-3">
					<li class="list-group-item list-group-item-success d-flex justify-content-between align-items-center">Final Benefit (Greater of A or B): <span>{{getmax(get_final_a(a_perc2,a_min, a_max, apb, a_perc1),get_final_b(avg_wage, b_ceiling, b_factor, b_perc, b_perc1, apb, b_max, b_min))}}</span></li>
				</ul>
				<div class="mt-2">
			<ul class="list-group">
				<li class="list-group-item list-group-item-warning"><i class="bi bi-exclamation-octagon-fill"></i> The above calculation is based on the data entered by the user. 
				Hence, the same may differ with the calculations using the data from database. In case of any mismatch, the calculations using the database data will be considered final.
				</li>
				<li class="list-group-item list-group-item-warning"><i class="bi bi-exclamation-octagon-fill"></i> The EDLI calculation for Date of Death from 08/01/2011 to 27/04/2021 will be done for service rendered in the same establishment only, wherever 12 months or above service is not completed in same establishment.
				</li>
			</ul>
		</div>
			</div>
		</div>
		<div class="row" style="">
    <div class="col-sm-3 align-self-start"></div>
    <div class="col-sm-3 align-self-center">
      <button type="button" class="btn btn-danger align-self-center" onclick="myFunction()">Download</button>
    </div>
    <div class="col-sm-3 align-self-end"></div>
 </div>
		
	</div>
<div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="staticBackdropLabel">EDLI Calculation based on Date of Death</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="row">
			<ul class="list-group mb-3 mt-5">
				<li class="list-group-item list-group-item-primary d-flex justify-content-between align-items-center">Eligibility Table</li>
				<li class="list-group-item list-group-item">
					<table class="table table-striped table-bordered table-sm">
						<thead>
							<tr>
								<td>Start</td>
								<td>End</td>
								<td>Min Balance</td>
								<td>Part A</td>
								<td>Part B</td>
							</tr>
						</thead>
						<tbody>
							<tr ng-repeat="item in list1">
								<td>{{item.start}}</td>
								<td>{{item.end}}</td>
								<td>{{item.min_balance}}</td>
								<td>{{item.part_a}}</td>
								<td>{{item.part_b}}</td>
							</tr>
						</tbody>
					</table>
				</li>
			</ul>
		</div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="staticBackdrop1" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel1" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="staticBackdropLabel">What is these parts and factors?</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        EDLI Calculation is very different from other scheme calculation. As it is a Deposit linked scheme, the average progressive balance or APB is one importtant factor.
		APB is average of total balance in 12(n) months prior to date of death(-any withdrawals). <br/><br/>
		The other factors are decided based on circulars issued from time to time and the applicability of the circular is based on date of death. 
		Hence, two major variables in EDLI calculation are Average Progressive Balance and Date of Death.
		Based on Date of death many factors are decided such as Minimum, Maximum, percentage of APB to be taken etc.
		
		<h4>What are the parts - Part A and Part B?</h4>
		EDLI amount calculation is done by two formulas and the member is eligible for the amount whichever is greater. You may check the table and relavent circulars by clicking link given in input form.
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular.min.js" type="text/javascript"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular-cookies.js" type="text/javascript"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular-route.js" type="text/javascript"></script>
	<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
	<script type="text/javascript" src="luxon.min.js"></script>
	<script>
	function myFunction() {
		window.print();
	}
	
	var app = angular.module('myApp', ['ngCookies']);
	app.controller('namesCtrl', ['$scope','$cookies','$cookieStore', '$http', function($scope,$cookies,$cookieStore, $http) {
		$http({
			method: 'GET',
			url: './edli2.json'
		}).then(function (success){
			$scope.list =success.data;
			//console.log($scope.list);
		},function (error){
			console.log(error)
		});
		
		$http({
			method: 'GET',
			url: './edli1.json'
		}).then(function (success){
			$scope.list1 =success.data;
			console.log($scope.list1);
		},function (error){
			console.log(error)
		});
		
		$scope.uan = 100000000000;
		$scope.dod = new Date('2020-02-16');
		limit1 = new Date('1976-08-01');
		limit2 = new Date('2024-04-27');

		$scope.apb = 1198984;
		$scope.a_min_bal = 0;
		$scope.a_min     = 50000; 
		$scope.a_max     = 100000; 
		$scope.a_perc1   = 40; 
		$scope.a_perc2   = 20; 
		$scope.b_ceiling = 15000; 
		$scope.b_factor  = 35; 
		$scope.b_perc    = 0;
		$scope.b_perc1    = 50;
		$scope.b_max     = 175000; 
		$scope.b_min     = 0;
		
		
		$scope.getmin = function(a,b) {
			if(a<b){
				return a;
			} else {
				return b;
			}
		}
		
		$scope.getmax = function(a,b) {
			if(a<b){
				return b;
			} else {
				return a;
			}
		}
		
		$scope.get_additional = function (avg, ceiling, factor, percent) {
			if(avg>ceiling){
				return 0;
			} else {
				val1 = factor*ceiling;
				val2 = avg*factor;
				val3 = percent*val2/100;
				if (val2+val3>val1) {
					return val1-val2;
				} else {
					return val3;
				}
			}
		}
		$scope.get_final_a = function(a_perc2,a_min, a_max, apb, a_perc1){
			val1 = (1+(a_perc2/100))*$scope.get_amt_a(a_min, a_max, apb, a_perc1)
			return parseInt(val1);
		}
		$scope.get_final_b = function(avg_wage, b_ceiling, b_factor, b_perc, b_perc1, apb, b_max, b_min){
			val1 = ($scope.getmin(avg_wage, b_ceiling)*b_factor) + $scope.get_additional(avg_wage, b_ceiling, b_factor, b_perc)
			val2 = b_perc1*apb/100;
			if(val2>b_max){
				val2=b_max;
			}
			if(val1+val2<b_min) {
			 return b_min
			} else {
			
				return parseInt(val1)+parseInt(val2);
			}
		}
		
		$scope.getParams = function(list, date) {
			console.log("test");
			if ( date < limit1 || date > limit2) {
				$scope.alert = "Date out of range of available circulars. Please enter date between 01-08-1976 to 27-04-2024";
			} else {
				for (let i = 0; i < list.length; i++) {
					start_date = luxon.DateTime.fromFormat(list[i]['start'], 'dd-MM-yyyy')
					end_date = luxon.DateTime.fromFormat(list[i]['end'], 'dd-MM-yyyy')
					if(date>= start_date && date<= end_date){
						console.log("hurrey")
						console.log(start_date)
						console.log(end_date)
						console.log("id found at: ", list[i]['id'])
						$scope.a_min_bal = list[i]['a_min_bal']
						$scope.a_min     = list[i]['a_min']
						$scope.a_max     = list[i]['a_max']
						$scope.a_perc1   = list[i]['a_perc1']
						$scope.a_perc2   = list[i]['a_perc2']
						$scope.b_ceiling = list[i]['b_ceiling']
						$scope.b_factor  = list[i]['b_factor']
						$scope.b_perc    = list[i]['b_perc']
						$scope.b_max     = list[i]['b_max']
						$scope.b_min     = list[i]['b_min']
						
					}
				}
			}
		}
		
		$scope.get_amt_a = function (min, max, amt, percent) {
		
			if(min>amt){
				return min;
			} else {
				val = min+(percent*(amt-min)/100);
				if(val>max) {
					return max;
				} else {
					return val;
				}
			}
		
		}
		

		
		$scope.percent_a = 40;
		$scope.min_a = 50000;
		$scope.max_a = 100000;
		$scope.additional =  20000; //20% additional benefit
		$scope.total = 120000;
		
		$scope.wages_avg = 16000;
		$scope.wages_limit = 15000;
		$scope.wages_cal = 15000;
		$scope.factor = 35;
		$scope.percent_b = 50;
		$scope.addtional2= 0;
		$scope.benefit_apb = 175000;
		$scope.limit_apb = 175000;
		
		
		/*
		$scope.list = array value
		*/
		
	}]);
	</script>
</body>
</html>