<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Decrypted Data</title>
</head>
<body>
    <h1>Decrypted Data from Encrypted JSON</h1>

    <!-- Input for password -->
    <div>
        <label for="password">Enter password to decrypt:</label>
        <input type="password" id="password" placeholder="Enter password">
        <button id="decryptBtn">Decrypt</button>
    </div>

    <h2>Data:</h2>
    <pre id="output"></pre>

    <script>
        // Function to convert a password to a CryptoKey
        async function getKeyFromPassword(password, salt) {
            const encoder = new TextEncoder();
            const keyMaterial = await crypto.subtle.importKey(
                "raw", 
                encoder.encode(password), 
                { name: "PBKDF2" }, 
                false, 
                ["deriveKey"]
            );
            
            return await crypto.subtle.deriveKey(
                { name: "PBKDF2", salt: salt, iterations: 100000, hash: 'SHA-256' },
                keyMaterial, 
                { name: "AES-GCM", length: 256 }, 
                false, 
                ["decrypt"]
            );
        }

        // Function to decrypt the JSON data using the password
        async function decryptData(encryptedBase64, password, salt) {
            try {
                // Convert the base64 encoded string to an ArrayBuffer
                const encryptedData = Uint8Array.from(atob(encryptedBase64), c => c.charCodeAt(0));
                
                // Get the decryption key from the password
                const key = await getKeyFromPassword(password, salt);
                
                // Extract IV and tag from the encrypted data
                const iv = encryptedData.slice(0, 12); // The IV is the first 12 bytes
                const tag = encryptedData.slice(12, 28); // The tag is the next 16 bytes
                const cipherText = encryptedData.slice(28); // The rest is the encrypted data
                
                const decryptedData = await crypto.subtle.decrypt(
                    { name: "AES-GCM", iv: iv, tag: tag },
                    key,
                    cipherText
                );

                // Convert the decrypted data to a string and parse as JSON
                const decoder = new TextDecoder();
                const decryptedText = decoder.decode(decryptedData);
                return JSON.parse(decryptedText); // Return parsed JSON object

            } catch (error) {
                console.error("Decryption failed:", error);
                alert("Decryption failed. Please check your password.");
            }
        }

        // Function to fetch and load the encrypted data from the JSON file
        async function loadEncryptedData() {
            try {
                // Fetch the encrypted data from the file
                const response = await fetch('encrypted_data.json'); // Adjust path as necessary
                const encryptedText = await response.json(); // Get the encrypted content as a JSON object

                // Return the encrypted content (base64 string) and salt
                return { encryptedBase64: encryptedText.encrypted_data, salt: new TextEncoder().encode(atob(encryptedText.salt)) };
            } catch (error) {
                console.error("Error loading encrypted file:", error);
                alert("Error loading the encrypted file.");
            }
        }

        // Event listener for decryption button
        document.getElementById('decryptBtn').addEventListener('click', async function() {
            const password = document.getElementById('password').value;

            if (!password) {
                alert("Please enter a password.");
                return;
            }

            // Load encrypted data and salt from the file
            const { encryptedBase64, salt } = await loadEncryptedData();

            if (!encryptedBase64) {
                alert("Failed to load encrypted data.");
                return;
            }

            // Decrypt the data
            const decryptedData = await decryptData(encryptedBase64, password, salt);
            console.log(decryptedData)
            // Display the decrypted data
            if (decryptedData) {
               
